<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>サプライズ忍者（秘伝・乱入之巻）</title>
    <!-- Google Fonts: 筆文字や和風明朝体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700&family=Yuji+Syuku&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=20260118_debug">
</head>

<body>
    <!-- Debug Console (User Requested) -->
    <div id="debug-console"
        style="position:fixed; top:0; left:0; width:100%; height:100px; background:rgba(0,0,0,0.8); color:#0f0; font-size:12px; z-index:9999; overflow-y:scroll; pointer-events:none; padding:5px; border-bottom:1px solid #0f0; display:block;">
        DEBUG CONSOLE STARTED...
    </div>

    <!-- アプリ全体を包むコンテナ -->
    <div id="app">

        <!-- Screen 1: 入力（Activity Entry） -->
        <section id="screen-entry" class="screen active">
            <div class="intro-container">
                <h1 class="main-title">秘伝・乱入之巻</h1>
                <div class="seal-mark-input" id="seal-input">現場</div>

                <div class="ninja-icon-large">🥷</div>
                <!-- Intro Text: Random Mantra -->
                <p id="intro-mantra" class="intro-text">いまの現場を記せ。忍者はここに乱入する。</p>

                <div class="form-group">
                    <label for="activity-input">現場（いま何してる？） <span class="sub-label">— 現場記録 —</span></label>
                    <input type="text" id="activity-input" placeholder="例：会議で議事録..." maxlength="30">
                </div>

                <div class="form-group">
                    <label for="category-select">状況（場所/モード） <span class="sub-label">— 環境条件 —</span></label>
                    <select id="category-select">
                        <option value="生活">生活（日常）</option>
                        <option value="仕事">仕事（忍務）</option>
                        <option value="学習">学習（修行）</option>
                        <option value="創作">創作（秘術）</option>
                        <option value="休憩">休憩（茶屋）</option>
                        <option value="移動">移動（早馬）</option>
                        <option value="その他">その他（不明）</option>
                    </select>
                </div>

                <button id="btn-open-scroll" class="btn-primary" type="button">乱入を召喚<div class="btn-sub">秘伝書を開帳</div>
                </button>

                <div class="footer-link">
                    <button id="btn-view-archive-from-entry" class="btn-text">巻物庫を開く（履歴）</button>
                </div>
            </div>
        </section>

        <!-- Screen 2: 結果（Main Result） -->
        <section id="screen-result" class="screen">
            <!-- 忍者メインビジュアル -->
            <div class="visual-area">
                <img src="assets/ninja.png?v=4" alt="Ninja Visual" class="ninja-img">
                <div class="visual-gradient"></div>
            </div>

            <!-- 巻物カード -->
            <div class="scroll-card-wrapper">
                <div class="scroll-card">
                    <!-- Notification Banner -->
                    <div id="raid-banner" class="notification-banner">【乱入発生】忍者が現れた！</div>

                    <div class="scroll-header">
                        <h2 class="scroll-title">秘伝・乱入之巻</h2>
                        <div id="seal-mark" class="seal-mark">極秘</div>
                    </div>

                    <div class="scroll-body">
                        <!-- 1. 口上 -->
                        <div class="section-header">
                            <span class="main-label">乱入状況</span>
                            <span class="sub-label">（口上）</span>
                            <span id="sfx-scene" class="sfx-tag"></span>
                        </div>
                        <div class="text-box">
                            <p id="result-scene" class="text-body-bold">ここに乱入シーンが表示されます。</p>
                        </div>
                        <hr class="divider-thin">

                        <!-- 2. 術式 -->
                        <div class="section-header">
                            <span class="main-label">乱入手順</span>
                            <span class="sub-label">（術式）</span>
                            <span id="sfx-process" class="sfx-tag"></span>
                        </div>
                        <div class="text-box">
                            <ol id="process-steps" class="process-steps">
                                <li>ステップ1</li>
                                <li>ステップ2</li>
                                <li>ステップ3</li>
                            </ol>
                        </div>
                        <hr class="divider-thin">

                        <!-- 3. 余韻 -->
                        <div class="section-header">
                            <span class="main-label">後味</span>
                            <span class="sub-label">（余韻）</span>
                            <span id="sfx-ochi" class="sfx-tag"></span>
                        </div>
                        <div class="text-box">
                            <p id="result-och" class="text-body">ここにオチが表示されます。</p>
                        </div>
                        <hr class="divider-thin">

                        <!-- 4. 判定 -->
                        <div id="judgment-area">
                            <div class="section-header">
                                <span class="main-label">忍者が来たら？</span>
                                <span class="sub-label">（判定）</span>
                            </div>
                            <div class="buttons-vertical">
                                <button id="btn-yes" class="btn-judgement btn-yes">乱入したら面白くなる<span
                                        class="sub-text">（開帳）</span></button>
                                <button id="btn-no" class="btn-judgement btn-no">乱入は邪魔<span
                                        class="sub-text">（封印）</span></button>
                            </div>

                            <!-- スライダーエリア（判定後に表示） -->
                            <div id="slider-area" class="hidden">
                                <div class="slider-label-group">
                                    <span id="slider-label-key">奥義圧</span>
                                    <span id="slider-value">50</span>/100
                                </div>
                                <input type="range" id="intensity-slider" min="0" max="100" value="50">

                                <textarea id="result-note" placeholder="一言メモ（任意）" rows="2"></textarea>

                                <button id="btn-save" class="btn-primary btn-save">巻物に刻む</button>
                                <button id="btn-cancel-choice" class="btn-text-small">選択解除</button>
                            </div>
                        </div>

                        <!-- 完了メッセージ（保存後に表示） -->
                        <div id="saved-message" class="hidden">
                            <p class="saved-text">―― 記録完了 ――</p>
                        </div>

                        <!-- Screen 2 Footer -->
                        <div id="result-footer-actions" class="result-footer">
                            <button id="btn-retry" class="btn-secondary">次の乱入を召喚</button>
                            <button id="btn-view-archive" class="btn-text">巻物庫を開く</button>
                        </div>

                        <!-- 写経モード時のみ表示 -->
                        <div id="shakyo-footer" class="shakyo-footer hidden">
                            — 秘伝・乱入之巻 / 記録番号: <span id="shakyo-log-id">0000</span> —
                        </div>
                    </div>
                </div>
                <!-- 木軸 -->
                <div class="scroll-axis axis-left"></div>
                <div class="scroll-axis axis-right"></div>
            </div>

            <!-- スクショモード切替フロートボタン -->
            <button id="btn-toggle-shakyo" class="btn-float-toggle">写経モード</button>
        </section>

        <!-- Screen 3: 履歴（Archive） -->
        <section id="screen-archive" class="screen">
            <header class="archive-header">
                <h2>巻物庫</h2>
                <button id="btn-back-to-entry" class="btn-text">戻る</button>
            </header>

            <div id="archive-list" class="archive-list">
                <!-- JSでリスト生成 -->
                <div class="empty-state">まだ巻物は存在せぬ。</div>
            </div>
        </section>

    </div>

    <!-- Scripts -->
    <!-- Scripts -->
    <script>
        (() => {
            const overlay = document.createElement("div");
            overlay.id = "__force_debug_overlay__";
            overlay.style.cssText = [
                "position:fixed", "top:6px", "left:6px", "z-index:2147483647",
                "background:rgba(0,0,0,.88)", "color:#ffe66d", "padding:10px 12px",
                "font:12px/1.35 monospace", "border:1px solid rgba(255,230,109,.5)",
                "border-radius:10px", "white-space:pre", "pointer-events:none",
                "max-width:70vw", "max-height:45vh", "overflow:hidden"
            ].join(";");
            const push = (m) => { overlay.textContent = m + "\n" + overlay.textContent; console.log("[FORCE]", m); };
            window.__forcePush = push;
            document.addEventListener("DOMContentLoaded", () => { document.body.appendChild(overlay); push("FORCE DEBUG HTML LOADED"); });
            window.addEventListener("error", (e) => push("ERROR: " + (e.message || e.type)));
            window.addEventListener("unhandledrejection", (e) => push("REJECT: " + (e.reason?.message || e.reason)));
        })();
    </script>

    <script type="module">
        const push = window.__forcePush || ((m) => console.log(m));
        push("APP IMPORT START");
        import('./js/app.js?v=20260118_force3')
            .then(() => push("APP IMPORT OK"))
            .catch((err) => {
                push("APP IMPORT FAIL: " + (err?.message || err));
                push("HINT: Check 'deck.js' exports vs 'app.js' imports.");
            });
    </script>
</body>

</html>